@import 'styles';

// --- BOOTSTRAP CORE IMPORTS ---
@import "bootstrap/scss/grid";
@import "bootstrap/scss/containers";
@import "bootstrap/scss/helpers";
@import "bootstrap/scss/nav";
@import "bootstrap/scss/offcanvas";
@import "bootstrap/scss/dropdown";
@import "bootstrap/scss/button-group";
@import "bootstrap/scss/list-group";
@import "bootstrap/scss/tables";
@import "bootstrap/scss/forms";
@import "bootstrap/scss/spinners";
@import "bootstrap/scss/alert";
@import "bootstrap/scss/popover";
@import "bootstrap/scss/tooltip";
@import "bootstrap/scss/modal";

// =====================================================
// MINIMALIST DASHBOARD THEME
// =====================================================

// --- GLOBAL UTILITIES ---
.transition-all {
  transition: all 0.15s ease;
}

.icon-primary-filter {
  filter: invert(31%) sepia(19%) saturate(2256%) hue-rotate(128deg) brightness(96%) contrast(89%);
}

.status-rejected-filter {
  filter: invert(53%) sepia(35%) saturate(3500%) hue-rotate(335deg) brightness(95%) contrast(90%);
}

.line-clamp-2 {
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.line-clamp-3 {
  display: -webkit-box;
  -webkit-line-clamp: 3;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

.extra-small {
  font-size: 0.7rem;
}

// --- STATUS BADGES (Enhanced) ---
.status-badge {
  padding: $space-1 $space-3;
  border-radius: $radius-md;
  font-size: 0.7rem;
  font-weight: 600;
  letter-spacing: 0.3px;
  text-transform: uppercase;
  display: inline-flex;
  align-items: center;
  gap: $space-1;

  &.status-pending {
    background-color: rgba($warning, 0.15);
    color: $warning-dark;
  }

  &.status-approved, &.status-verified {
    background-color: rgba($success, 0.12);
    color: darken($success, 5%);
  }

  &.status-rejected, &.status-danger {
    background-color: rgba($danger, 0.12);
    color: $danger;
  }
  
  &.status-info, &.status-officer {
    background-color: rgba($info, 0.12);
    color: darken($info, 15%);
  }
  
  &.status-deactivated {
    background-color: $gray-100;
    color: $gray-500;
  }
  
  &.status-primary {
    background-color: rgba($primary, 0.12);
    color: $primary;
  }
}

// --- MODERN FORM STYLING ---
.form-control, .form-select {
  border-radius: $radius-md;
  border: 1px solid $gray-200;
  padding: $space-2 $space-3;
  font-size: 0.9rem;
  transition: all $transition-fast;
  
  &:focus {
    border-color: $primary;
    box-shadow: 0 0 0 3px rgba($primary, 0.1);
  }
  
  &::placeholder {
    color: $gray-400;
  }
}

.form-label {
  font-size: 0.8rem;
  font-weight: 600;
  color: $gray-700;
  margin-bottom: $space-1;
}

.form-text {
  font-size: 0.75rem;
  color: $gray-500;
}

.input-group {
  .input-group-text {
    background-color: $gray-50;
    border: 1px solid $gray-200;
    border-radius: $radius-md;
    color: $gray-500;
    padding: $space-2 $space-3;
  }
  
  .form-control {
    border-radius: $radius-md;
  }
  
  // Fix border radius for input groups
  > :not(:first-child):not(.dropdown-menu):not(.valid-tooltip):not(.valid-feedback):not(.invalid-tooltip):not(.invalid-feedback) {
    border-top-left-radius: 0;
    border-bottom-left-radius: 0;
  }
  
  > :not(:last-child):not(.dropdown-menu):not(.dropdown-toggle) {
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
  }
}

// --- ENHANCED MODAL STYLING ---
.modal {
  .modal-content {
    border: none;
    border-radius: $radius-xl;
    box-shadow: $shadow-xl;
    overflow: hidden;
  }
  
  .modal-header {
    padding: $space-5 $space-5 $space-3;
    border-bottom: 1px solid $gray-100;
    
    .modal-title {
      font-weight: 700;
      font-size: 1.15rem;
      color: $gray-800;
    }
    
    .btn-close {
      opacity: 0.5;
      transition: opacity $transition-fast;
      
      &:hover {
        opacity: 1;
      }
    }
  }
  
  .modal-body {
    padding: $space-5;
    
    // Form rows in modals
    .row.g-3 {
      margin-top: 0;
    }
  }
  
  .modal-footer {
    padding: $space-3 $space-5 $space-5;
    border-top: 1px solid $gray-100;
    background-color: $gray-50;
    gap: $space-2;
  }
}

// --- ENHANCED DROPDOWN STYLING ---
.dropdown-menu {
  border: none;
  border-radius: $radius-lg;
  box-shadow: $shadow-lg;
  padding: $space-2;
  min-width: 180px;
  
  .dropdown-header {
    font-size: 0.65rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: $gray-400;
    padding: $space-2 $space-3;
  }
  
  .dropdown-item {
    border-radius: $radius-md;
    padding: $space-2 $space-3;
    font-size: 0.875rem;
    color: $gray-700;
    transition: all $transition-fast;
    display: flex;
    align-items: center;
    gap: $space-2;
    
    &:hover, &:focus {
      background-color: $gray-100;
      color: $gray-900;
    }
    
    &.active, &:active {
      background-color: rgba($primary, 0.1);
      color: $primary;
    }
    
    &.text-danger:hover {
      background-color: rgba($danger, 0.08);
      color: $danger;
    }
    
    img, svg {
      width: 16px;
      height: 16px;
      opacity: 0.6;
    }
  }
  
  .dropdown-divider {
    margin: $space-2 0;
    border-color: $gray-100;
  }
}

// --- ALERT STYLING ---
.alert {
  border-radius: $radius-lg;
  border: none;
  padding: $space-4;
  
  &.alert-success {
    background-color: rgba($success, 0.1);
    color: darken($success, 10%);
  }
  
  &.alert-danger {
    background-color: rgba($danger, 0.1);
    color: $danger;
  }
  
  &.alert-warning {
    background-color: rgba($warning, 0.12);
    color: $warning-dark;
  }
  
  &.alert-info {
    background-color: rgba($info, 0.1);
    color: darken($info, 15%);
  }
}

// --- ACTION BUTTONS (Minimal) ---
.btn-group-custom {
  background: $white;
  border: 1px solid $gray-200;
  border-radius: 6px;
  display: flex;
  overflow: hidden;
  z-index: 5;
  position: relative;

  .btn {
    border: none;
    background: transparent;
    padding: 0.35rem 0.5rem;

    &:hover {
      background-color: $gray-100;
    }

    &:not(:last-child) {
      border-right: 1px solid $gray-200;
    }

    img {
      opacity: 0.5;
    }
  }
}

// --- LAYOUT ---
#dashboard-content {
  min-height: calc(100vh - 56px);
  background-color: $gray-100;
  padding: 1.5rem;

  @include media-breakpoint-up(lg) {
    min-height: 100vh;
    padding: 2rem;
  }
}

// --- SIDEBAR (Minimal) ---
.offcanvas-start.bg-primary {
  background-color: $white !important;
  border-right: 1px solid $gray-200;

  .nav-link {
    color: $gray-600;
    margin-bottom: 0.15rem;
    border-radius: 6px;
    padding: 0.65rem 0.85rem;
    font-weight: 500;
    font-size: 0.875rem;

    &:hover,
    &:focus {
      color: $primary;
      background-color: rgba($primary, 0.06);
    }

    &.active {
      color: $primary;
      background-color: rgba($primary, 0.1);
      font-weight: 600;

      img {
        filter: invert(36%) sepia(35%) saturate(836%) hue-rotate(130deg) brightness(93%) contrast(92%);
      }
    }
  }
}

// --- SIDEBAR INDEPENDENT SCROLL ---
// Makes the sidebar scroll independently from the main content
aside.offcanvas-lg.offcanvas-start {
  // Desktop: Fixed sidebar with independent scroll
  @include media-breakpoint-up(lg) {
    position: sticky !important;
    top: 0;
    height: 100vh !important;
    max-height: 100vh !important;
    overflow: hidden !important;
    display: flex !important;
    flex-direction: column !important;
    
    // Ensure flex children can shrink
    > * {
      min-height: 0;
    }
  }
  
  // Header area (logo + hr) - keep fixed at top
  > a:first-child,
  > hr:first-of-type {
    flex-shrink: 0;
  }
  
  // Keep user dropdown at bottom, never scrolled
  > .dropdown,
  > .dropdown.mt-auto {
    flex-shrink: 0;
  }
}

// Scrollable nav wrapper with fading scrollbar (Desktop only)
.sidebar-nav-scroll {
  @include media-breakpoint-up(lg) {
    // Firefox: hide scrollbar visually but keep scroll
    scrollbar-width: none;
    -ms-overflow-style: none; // IE/Edge
    
    // Show scrollbar on hover (Firefox)
    &:hover {
      scrollbar-width: thin;
      scrollbar-color: $gray-300 transparent;
    }
    
    // WebKit (Chrome, Safari, Edge): hide scrollbar visually
    &::-webkit-scrollbar {
      width: 0;
      height: 0;
    }
    
    // Show scrollbar on container hover (WebKit)
    &:hover::-webkit-scrollbar {
      width: 4px;
    }
    
    &:hover::-webkit-scrollbar-track {
      background: transparent;
    }
    
    &:hover::-webkit-scrollbar-thumb {
      background-color: $gray-300;
      border-radius: 4px;
    }
    
    &:hover::-webkit-scrollbar-thumb:hover {
      background-color: $gray-400;
    }
  }
}

// --- MOBILE SIDEBAR FIXES (Prevent Glitching) ---
.offcanvas {
  // GPU acceleration to prevent flickering/glitching
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  -webkit-transform: translateZ(0);
  transform: translateZ(0);
  will-change: transform;
  
  // Smooth scrolling for iOS
  -webkit-overflow-scrolling: touch;
  
  // Prevent visual artifacts during animation
  &.offcanvas-start {
    transform: translateX(-100%);
    
    &.show, &.showing {
      transform: translateX(0);
    }
  }
  
  // Smooth transition
  transition: transform 0.3s ease-in-out !important;
}

// Backdrop stability
.offcanvas-backdrop {
  -webkit-backface-visibility: hidden;
  backface-visibility: hidden;
  position: fixed !important;
  top: 0;
  left: 0;
  width: 100vw !important;
  height: 100vh !important;
  
  &.show {
    opacity: 0.5;
  }
  
  &.fade {
    transition: opacity 0.15s linear !important;
  }
}

// --- CARDS (Minimal) ---
.dashboard-card {
  border: 1px solid $gray-200;
  border-radius: 8px;
  background-color: $white;
  box-shadow: none;

  &:hover {
    border-color: $gray-300;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
  }
}

.event-card {
  @extend .dashboard-card;

  .card-img-top {
    border-radius: 8px 8px 0 0;
  }
}

.file-card {
  @extend .dashboard-card;
  position: relative;
  overflow: hidden;

  .file-icon-wrapper {
    background-color: $gray-100;
  }

  .card-click-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 70%;
    cursor: pointer;
    z-index: 2;
  }

  // Ensure interactive elements are clickable
  .mt-auto,
  .view-details-trigger,
  .dropdown {
    position: relative;
    z-index: 10;
  }

  // Compact buttons for tight spaces
  .btn {
    font-size: 0.85rem;
    padding: 0.4rem 0.6rem;

    span {
      font-size: 0.75rem;
    }
  }
}

.student-card {
  @extend .dashboard-card;

  &:hover {
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
  }

  .dropdown-toggle::after {
    display: none;
  }

  .file-icon-wrapper {
    background-color: $gray-100;
    color: $gray-600;
  }
}

.hover-shadow:hover {
  box-shadow: 0 2px 8px rgba(0,0,0,.08);
  background-color: $gray-50;
  border-color: $gray-300 !important;
}

// --- GRID ---
#file-cards-container {
  @include media-breakpoint-up(lg) {
    &.row-cols-lg-4 > * {
      flex: 0 0 25%;
      max-width: 25%;
    }
  }
}

// --- FORM ELEMENTS ---
.upload-drop-zone {
  border: 1px dashed $gray-300;
  background-color: $gray-50;
  border-radius: 8px;

  &:hover {
    border-color: $primary;
    background-color: rgba($primary, 0.02);
  }
}

.file-item {
  border-left: 3px solid $primary;
  background: $white;
  margin-bottom: 0.5rem;
  border-radius: 6px;
  padding: 0.85rem;

  &:hover {
    background-color: $gray-50;
  }
}

// --- TABLES (Minimal) ---
.table-responsive {
  background: $white;
  border-radius: 8px;
  border: 1px solid $gray-200;
  overflow: hidden;

  table {
    margin-bottom: 0;
    
    thead th {
      background-color: $gray-50;
      color: $gray-600;
      font-weight: 600;
      text-transform: uppercase;
      font-size: 0.7rem;
      letter-spacing: 0.3px;
      padding: 0.85rem 1rem;
      border-bottom: 1px solid $gray-200;
    }
    
    tbody td {
      padding: 0.85rem 1rem;
      vertical-align: middle;
      border-bottom: 1px solid $gray-100;
      font-size: 0.875rem;
    }
    
    tbody tr:last-child td {
      border-bottom: none;
    }
  }
}

// =====================================================
// MOBILE-FIRST RESPONSIVE ENHANCEMENTS
// =====================================================

// --- MOBILE TABLE ALTERNATIVE (Card Layout) ---
.mobile-card-list {
  display: none;
  
  @include media-breakpoint-down(md) {
    display: block;
  }
}

.mobile-data-card {
  background: $white;
  border: 1px solid $gray-200;
  border-radius: 10px;
  padding: 1rem;
  margin-bottom: 0.75rem;
  
  &:last-child {
    margin-bottom: 0;
  }
  
  .mobile-card-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 0.75rem;
    padding-bottom: 0.75rem;
    border-bottom: 1px solid $gray-100;
    
    .mobile-card-title {
      font-weight: 600;
      font-size: 0.95rem;
      color: $gray-800;
      margin: 0;
      flex: 1;
      padding-right: 0.5rem;
    }
    
    .mobile-card-badge {
      flex-shrink: 0;
    }
  }
  
  .mobile-card-body {
    .mobile-data-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.4rem 0;
      
      &:not(:last-child) {
        border-bottom: 1px dashed $gray-100;
      }
      
      .mobile-data-label {
        font-size: 0.75rem;
        color: $gray-500;
        text-transform: uppercase;
        letter-spacing: 0.3px;
        font-weight: 500;
      }
      
      .mobile-data-value {
        font-size: 0.875rem;
        color: $gray-700;
        font-weight: 500;
        text-align: right;
      }
    }
  }
  
  .mobile-card-footer {
    margin-top: 0.75rem;
    padding-top: 0.75rem;
    border-top: 1px solid $gray-100;
    display: flex;
    justify-content: flex-end;
    gap: 0.5rem;
  }
}

// Hide desktop table on mobile, show card list
.desktop-table {
  display: block;
  
  @include media-breakpoint-down(md) {
    display: none !important;
  }
}

// --- MOBILE DASHBOARD CONTENT ---
@include media-breakpoint-down(md) {
  #dashboard-content {
    padding: 1rem !important;
  }
  
  // Smaller headers on mobile
  header {
    h1, .display-6 {
      font-size: 1.35rem !important;
      line-height: 1.3;
    }
    
    p {
      font-size: 0.85rem !important;
    }
  }
  
  // Cards grid adjustments
  .row-cols-md-2,
  .row-cols-lg-3,
  .row-cols-xl-3,
  .row-cols-xxl-4 {
    &.g-4 {
      --bs-gutter-x: 0.75rem;
      --bs-gutter-y: 0.75rem;
    }
  }
  
  // Dashboard cards
  .dashboard-card,
  .student-card,
  .file-card,
  .event-card {
    .card-body {
      padding: 1rem !important;
    }
  }
  
  // Form elements
  .form-control,
  .form-select {
    font-size: 16px !important; // Prevents zoom on iOS
    padding: 0.65rem 0.85rem;
  }
  
  // Buttons
  .btn {
    padding: 0.6rem 1rem;
    font-size: 0.875rem;
  }
  
  // Filter/Search header sections
  .d-flex.flex-column.flex-sm-row,
  .d-flex.flex-column.flex-lg-row {
    gap: 0.75rem !important;
    
    .input-group,
    .form-select {
      max-width: 100% !important;
      width: 100%;
    }
  }
}

// --- MOBILE MODALS ---
@include media-breakpoint-down(md) {
  .modal-dialog {
    margin: 0.5rem;
    max-width: calc(100% - 1rem);
    
    &.modal-dialog-centered {
      min-height: calc(100% - 1rem);
    }
  }
  
  .modal-content {
    border-radius: 12px;
    
    .modal-header {
      padding: 1rem 1rem 0.75rem;
    }
    
    .modal-body {
      padding: 1rem !important;
    }
    
    .modal-footer {
      padding: 0.75rem 1rem 1rem;
      flex-wrap: wrap;
      gap: 0.5rem;
      
      .btn {
        flex: 1;
        min-width: 120px;
      }
    }
  }
}

// --- MOBILE EMPTY STATES ---
@include media-breakpoint-down(md) {
  .empty-state,
  .empty-events-state {
    padding: 2rem 1.5rem;
    
    .empty-icon-wrapper,
    .empty-icon {
      width: 60px;
      height: 60px;
      
      img {
        width: 28px;
      }
    }
    
    h5, h4 {
      font-size: 1rem;
    }
    
    p {
      font-size: 0.85rem;
    }
  }
}

// --- MOBILE ACTION BUTTONS ---
@include media-breakpoint-down(md) {
  .btn-group-custom {
    .btn {
      padding: 0.5rem 0.65rem;
    }
  }
  
  // Floating action buttons
  .position-fixed.bottom-0.end-0 {
    margin: 1rem !important;
    
    &[style*="width: 60px"] {
      width: 52px !important;
      height: 52px !important;
    }
  }
}

// --- MOBILE BADGES ---
@include media-breakpoint-down(md) {
  .status-badge,
  .badge {
    padding: 0.3rem 0.6rem;
    font-size: 0.65rem;
  }
}

// --- MOBILE DROPDOWNS ---
@include media-breakpoint-down(md) {
  .dropdown-menu {
    font-size: 0.875rem;
    
    .dropdown-item {
      padding: 0.65rem 1rem;
    }
  }
}

// --- TOUCH-FRIENDLY TARGETS ---
@include media-breakpoint-down(md) {
  // Ensure minimum touch target size (44px recommended)
  .btn-sm {
    min-height: 38px;
    min-width: 38px;
  }
  
  .nav-link {
    padding: 0.75rem 1rem !important;
  }
  
  // Card clickable areas
  [role="button"],
  [style*="cursor: pointer"] {
    min-height: 44px;
  }
}

// --- MOBILE STATS/SUMMARY CARDS ---
@include media-breakpoint-down(md) {
  .col-md-4,
  .col-md-3 {
    &:has(.card) {
      .card-body {
        padding: 1rem;
        
        .h3, h3 {
          font-size: 1.25rem;
        }
        
        .h6, h6 {
          font-size: 0.7rem;
        }
      }
    }
  }
}

// --- SCROLL SNAP FOR HORIZONTAL CAROUSELS ---
.mobile-scroll-container {
  @include media-breakpoint-down(md) {
    display: flex;
    overflow-x: auto;
    scroll-snap-type: x mandatory;
    gap: 0.75rem;
    padding-bottom: 0.5rem;
    -webkit-overflow-scrolling: touch;
    
    &::-webkit-scrollbar {
      height: 4px;
    }
    
    &::-webkit-scrollbar-thumb {
      background: $gray-300;
      border-radius: 4px;
    }
    
    > * {
      scroll-snap-align: start;
      flex-shrink: 0;
    }
  }
}

// --- MOBILE SIDEBAR/OFFCANVAS ---
@include media-breakpoint-down(lg) {
  .offcanvas-start {
    width: 280px !important;
    max-width: 85vw;
    
    // Ensure smooth animation without glitches
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
    -webkit-transform-style: preserve-3d;
    transform-style: preserve-3d;
    
    // Stable positioning
    position: fixed !important;
    top: 0 !important;
    bottom: 0 !important;
    left: 0 !important;
    height: 100vh !important;
    height: 100dvh !important; // Dynamic viewport height for mobile browsers
    
    // Prevent content jumping
    overflow-y: auto;
    overflow-x: hidden;
    overscroll-behavior: contain;
  }
  
  // Ensure body doesn't scroll when offcanvas is open
  body.offcanvas-open {
    overflow: hidden !important;
    position: fixed !important;
    width: 100% !important;
    height: 100% !important;
  }
}

// --- PULL-TO-REFRESH INDICATOR (visual hint) ---
.pull-refresh-indicator {
  text-align: center;
  padding: 1rem;
  color: $gray-400;
  font-size: 0.75rem;
  display: none;
  
  @include media-breakpoint-down(md) {
    display: block;
  }
}

// --- BOTTOM SAFE AREA (for notched devices) ---
@supports (padding-bottom: env(safe-area-inset-bottom)) {
  @include media-breakpoint-down(md) {
    #dashboard-content {
      padding-bottom: calc(1.5rem + env(safe-area-inset-bottom));
    }
    
    .position-fixed.bottom-0 {
      margin-bottom: calc(1rem + env(safe-area-inset-bottom)) !important;
    }
  }
}

// --- RESPONSIVE ---
@include media-breakpoint-down(lg) {
  .offcanvas-start {
    width: 260px !important;
    
    // Ensure stable rendering
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
  }
  
  // Fix z-index stacking for mobile
  .offcanvas {
    z-index: 1055 !important;
  }
  
  .offcanvas-backdrop {
    z-index: 1050 !important;
  }
}
